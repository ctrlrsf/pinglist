<html>
  <head>
    <script src="http://fb.me/react-0.12.2.js"></script>
    <script src="http://fb.me/JSXTransformer-0.12.2.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
  </head>
  <body>
    <h1>Pinglist</h1>

    <div id="content"></div>

    <script type="text/jsx">
var formatLatency = function(microsecs) {
  return (microsecs / 1e6).toFixed(2) + "ms"
}

var formatStatus = function(statusInt) {
  if (statusInt === 1) {
    return "Online"
  }
  return "Offline"
}



var HostList = React.createClass({
  getInitialState: function() {
    return {
      hostList: []
    };
  },

  componentDidMount: function() {
    this.loadData();
  },

  loadData: function() {
    $.get(this.props.source, function(result) {
      if (result !== null) {
        var hostList = result
        if (this.isMounted()) {
          this.setState({
            hostList: hostList
          });
        }
      }
    }.bind(this));
    setTimeout(this.loadData, 5000)
  },

  render: function() {
    var hostLiNodes = this.state.hostList.map(function (host) {
      return (
        <Host key={host.Address} address={host.Address} status={host.Status} latency={host.Latency} />
      );
    });
    return (
      <div>
      {hostLiNodes}
      </div>
    );
  }
});

var Host = React.createClass({
  render: function() {
    var offlineColor = "#FF0000"
    var onlineColor = "#00FF00"
    var statusColor

    if (this.props.status === 1) {
      statusColor = onlineColor
    } else {
      statusColor = offlineColor
    }

    var divStyle = {
      color: statusColor,
      fontWeight: "bold",
    }

    return (
      <div style={divStyle}>
      {this.props.address} - {formatStatus(this.props.status)} - {formatLatency(this.props.latency)}
      </div>
    );
  }
});

var apiUrl = window.location.href + "api/hosts"

React.render(<HostList source={apiUrl} />, document.getElementById("content"))
    </script>
  </body>
</html>
